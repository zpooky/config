# to allow cron jobs to read keyring
touch $HOME/.Xdbus
chmod 600 $HOME/.Xdbus
env | grep DBUS_SESSION_BUS_ADDRESS > $HOME/.Xdbus
echo 'export DBUS_SESSION_BUS_ADDRESS' >> $HOME/.Xdbus

# using terminal emulator xterm with 256 color support
case "$TERM" in
  xterm)TERM=xterm-256color;;
esac

# git ps line
if [[ -e ~/.git-prompt.sh ]]; then
  source ~/.git-prompt.sh
fi

#
[[ -f ~/.LESS_TERMCAP ]] && . ~/.LESS_TERMCAP

if [[ -e $HOME/bin ]]; then
  PATH=$HOME/bin/:$PATH
fi

CABAL_PACKAGE_BIN=$HOME/.cabal/bin
if [[ -e $CABAL_PACKAGE_BIN ]]; then
  PATH=$CABAL_PACKAGE_BIN:$PATH
fi

if [ -z "$LD_LIBRARY_PATH" ]; then
  export LD_LIBRARY_PATH
fi
LD_LIBRARY_PATH=/usr/lib64:/usr/local/lib:$LD_LIBRARY_PATH

# CABAL_LIBS=~/.cabal/lib/x86_64-linux-ghc-8.0.2
# if [ -e $CABAL_LIBS ]; then
#   export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$CABAL_LIBS
# fi

if [ -z "$LIBRARY_PATH" ]; then
  export LIBRARY_PATH
fi
# LIBRARY_PATH=$CABAL_LIBS:$LIBRARY_PATH

SASAL_LIB=/usr/local/lib/sasl2
if [[ -e $SASAL_LIB ]]; then
  LD_LIBRARY_PATH=$SASAL_LIB:$LD_LIBRARY_PATH
fi

TMUX_COMPLETION=/usr/share/doc/tmux/examples/bash_completion_tmux.sh
if [[ -e $TMUX_COMPLETION ]]; then
  source $TMUX_COMPLETION
fi

CABAL_BIN=~/.cabal/bin
if [[ -e $CABAL_BIN ]]; then
  PATH=$CABAL_BIN:$PATH
fi

QUTEBROWSER_BIN=/usr/bin/qutebrowser
if [[ -e $QUTEBROWSER_BIN ]]; then
  export BROWSER=$QUTEBROWSER_BIN
fi

export EDITOR='vim'
export VISUAL='vim'

# alias
DOTFILES=$HOME/dotfiles
DOTFILES_LIB=$DOTFILES/lib
DROPBOX=$HOME/Dropbox/root
REF_DIR="$DROPBOX/\[\]ref"
DROPBOX_LINUX=$REF_DIR/linux
DROPBOX_NETWORK=$REF_DIR/network

alias sp-tmux="vim $DROPBOX_LINUX/tmux.txt"
alias sp-vim="vim $DROPBOX_LINUX/vim.txt"
alias sp-vim-cpp="vim $DROPBOX_LINUX/vim/cpp"
alias sp-vim-extra="vim $DROPBOX_LINUX/vim/extra"
alias sp-vim-jump="vim $DROPBOX_LINUX/vim/jump.md"
alias sp-xclip="vim $DROPBOX_LINUX/xclip.txt"
alias sp-gdb="vim $DROPBOX_LINUX/debug/gdb.md"
alias sp-perf="vim $DROPBOX_LINUX/debug/perf.txt"
alias sp-ref="cd $DROPBOX_LINUX/"
alias sp-todo="cd ~/Dropbox/term_todo/"
alias sp-systemd="vim $DROPBOX_LINUX/systemd.md"
alias sp-gcc="vim ~/Dropbox/root/[]ref/c/gcc.md"
alias sp-linker="vim $DROPBOX_LINUX/debug/linker-debug.md"
alias sp-cdebug="vim $DROPBOX_LINUX/debug/cpp-debug.md"
alias sp-sed="vim $DROPBOX_LINUX/sed.md"
alias sp-ack="vim $DROPBOX_LINUX/ack.md"
alias sp-linux="cd $DROPBOX_LINUX"
alias sp-tar="vim $DROPBOX_LINUX/compression.txt"
alias sp-package="vim $DROPBOX_LINUX/install.txt"
alias sp-mutt="vim $DROPBOX_LINUX/mutt.txt"
alias sp-w3m="vim $DROPBOX_LINUX/w3m.txt"
alias sp-interview="cd $DROPBOX/interview"
alias sp-grep="vim $DROPBOX_LINUX/grep.md"
alias sp-signal="vim $DROPBOX_LINUX/signal.md"
alias sp-sc="vim $DROPBOX_LINUX/sequential_consistency.md"
alias sp-win="vim $REF_DIR/win.md"
alias sp-i3wm="vim $REF_DIR/i3wm.md"
alias sp-openssl="vim $REF_DIR/sec/openssl.mk"
alias sp-openwrt="vim $REF_DIR/openwrt.md"
alias sp-network="vim $DROPBOX_NETWORK/linux.md"
alias sp-visual="vim $REF_DIR/visual-studio.md"
alias sp-proj="cd $DROPBOX/project"
alias sp-printf="vim $REF_DIR/c/printf.md"
alias sp-alignment="vim $REF_DIR/c/alignment.md"
alias sp-make="vim $REF_DIR/c/Makefile"
alias sp-carray="vim $REF_DIR/c/carray.md"
alias sp-books="vim $DROPBOX/books.md"
alias sp-debug="cd $REF_DIR/linux/debug"
alias sp-dropbox="cd $REF_DIR"
alias sp-mount="vim $REF_DIR/linux/mount.txt"
alias sp-backus-naur-form="vim $REF_DIR/bnf.md"
alias sp-util="vim $REF_DIR/util.md"
alias sp-tunnel="vim $REF_DIR/ssh_tunnel.md"
alias sp-mkdir="vim $REF_DIR/mkdir.md"
alias sp-overclock="vim $REF_DIR/overclock.mkd"
alias sp-tls="vim $REF_DIR/tls2.md"
alias sp-dd="vim $REF_DIR/dd.md"
alias sp-pipe="vim $REF_DIR/linux/pipe.txt"
alias cpp-debug="vim $REF_DIR/linux/debug/cpp-debug.md"
alias sp-tcpdump="vim $REF_DIR/linux/debug/tcpdump.txt"
alias sp-markdown="vim $REF_DIR/linux/markdown.md"
alias sp-date="vim $REF_DIR/linux/date.md"
alias sp-bash="vim $REF_DIR/linux/bash.md"
alias sp-bitcoin="vim $REF_DIR/bitcoin.md"

alias sp-compuverdeutil="vim $REF_DIR/util.md"
# ===============================================
# ===============================================
# =_______________COMMANDS______________________=
# ===============================================

#cygwin
which sudo > /dev/null 2>&1
WHICH_SUDO=$?
hash sudo > /dev/null 2>&1
HASH_SUDO=$?

if [ $WHICH_SUDO -eq $HASH_SUDO ]; then
  if [ ! $WHICH_SUDO -eq 0 ]; then
    alias sudo=$HOME/dotfiles/sudo
  fi
fi

#git
alias gitcommit="git commit"
alias "cd-"="cd -"
alias gitst="git st"
alias gitadd="git add"

#khal
alias sp-khal='khal calendar -a red -a personal --format="{red-bold}{start-time}{reset}-{green-bold}{end-time}{reset} {calendar-color}{title}{reset}{yellow}{repeat-symbol}{reset} [{cyan}{location}{reset}][{magenta}{calendar}{reset}]"'
alias k="sp-khal"
alias m="ms"

#mutt
alias ms="mutt -F $HOME/.mutt/user_personal"
alias mf="mutt -F $HOME/.mutt/user2_personal"
alias mw="mutt -F $HOME/.mutt/user_work"

alias n="newsbeuter"
alias duh="du -h -d 0 [^.]*"

#force ssh to use xterm when ssh instead of tmux-colour256
alias ssh='TERM=xterm ssh'

alias sp-sync='$DOTFILES_LIB/keypass_cron.sh; $DOTFILES_LIB/offlineimap_cron.sh; $DOTFILES_LIB/vdirsyncer_cron.sh'
alias port-scan='netstat -alnptu | egrep '\''Proto|LISTEN'\'''

alias sp-open="$DOTFILES_LIB/keypass_cron.sh; $DOTFILES_LIB/open_keyring.py"
alias sp-space="du -hsc *"
alias sp-root="cd \`$DOTFILES_LIB/git_root.sh\`"
#tmux
# force the 256 colors compatibility
alias tmux='tmux -2'
alias sp-source='tmux source-file ~/.tmux.conf; powerline-daemon --replace'
# meta alias
alias sp-alias="vim $DOTFILES/extrarc && source $DOTFILES/extrarc"
alias sp-vimrc="vim ~/.vimrc"

#repeats $1
alias sp_repeat="~/dotfiles/lib/repeat.sh"

# ===============================================
# ===============================================
# =____________DEVELOPMENT______________________=
# ===============================================
alias cpp-extends="$HOME/dotfiles/lib/cpp_extends.sh"
alias cpp-grep="$HOME/dotfiles/lib/cpp_grep.sh"
alias cpp-funcall="$HOME/dotfiles/lib/cpp_function_call.sh"
alias cpp-fundeclare="$HOME/dotfiles/lib/cpp_function_declare.sh"
alias cpp-conscall="$HOME/dotfiles/lib/cpp_constructor_call.sh"
alias cpp-gdb="$HOME/dotfiles/lib/tmux-gdb.sh"

alias sp_gdb="$HOME/dotfiles/lib/gdb_tmux_dashboard.sh"

function setup_project(){
  if [ ! -e .git ];then
    echo 'project root is required to be git:ed'
    exit 1
  fi
#
  rm .tags
  touch .tags
  ctags -R *
#
  # ack-grep -f --cpp > cscope.files
  # cscope -b -q -k
#
  gtags
#
  #-c g++ -F ycm -F cc
  if [[ -e CMakeLists.txt ]]; then
    ~/sources/YCM-Generator/config_gen.py . -b cmake --verbose -e --format ycm
    ~/sources/YCM-Generator/config_gen.py . -b cmake --verbose -e --format cc
  fi
  if [[ -e Makefile ]]; then
    ~/sources/YCM-Generator/config_gen.py . -b make --verbose -e --format ycm
    ~/sources/YCM-Generator/config_gen.py . -b make --verbose -e --format cc
  fi
}
alias sp-setup='setup_project'

function makex() {
  pathpat="(/[^/]*)+:[0-9]+"
  ccred=$(echo -e "\033[0;31m")
  ccyellow=$(echo -e "\033[0;33m")
  ccend=$(echo -e "\033[0m")
  /usr/bin/make "$@" 2>&1 | sed -E -e "/[Ee]rror[: ]/ s%$pathpat%$ccred&$ccend%g" -e "/[Ww]arning[: ]/ s%$pathpat%$ccyellow&$ccend%g"
  return ${PIPESTATUS[0]}
}
alias makex="makex | less -RiN -p error"

# vim: set ft=sh:
